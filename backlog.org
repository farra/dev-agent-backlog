#+TITLE: dev-agent-backlog Backlog
#+SETUPFILE: ./org-setup.org

* Current WIP

Active tasks checked out from design docs.

** Active

*** TODO [DAB-011-06] Test plugin locally                                 :p1:
:PROPERTIES:
:DESIGN: [[file:docs/design/011-plugin-architecture.org::*Tasks][DAB-011-06 in 011-plugin-architecture.org]]
:EFFORT: M
:END:

Use =claude --plugin-dir ./plugin= to test all commands and skills.

** Blocked

** Up Next

* About This File

This is the *working surface* for dev-agent-backlog development.

*Design docs* (=docs/design/*.org=) are the canonical archive of decisions and tasks.
*This file* is where active work gets checked out, tracked, and reconciled.

** System Overview

#+begin_example
  Design Docs (canonical)              backlog.org (working surface)
  ┌─────────────────────────┐         ┌─────────────────────────┐
  │ ** TODO [DAB-001-01]    │─checkout→ *** TODO [DAB-001-01]  │
  │                         │         │ :DESIGN: [[file:...]]  │
  └─────────────────────────┘         │ progress notes...      │
                                      └───────────┬────────────┘
                                                  │ work
                                                  ▼
                                      ┌─────────────────────────┐
                                      │ *** DONE [DAB-001-01]   │
                                      └───────────┬────────────┘
                                                  │ reconcile
                                                  ▼
  ┌─────────────────────────┐         ┌─────────────────────────┐
  │ ** DONE [DAB-001-01]    │←────────│ (removed)               │
  │ :VERSION: v1.0          │         └─────────────────────────┘
  └─────────────────────────┘
#+end_example

** Workflow

1. *Checkout*: Copy task to Active, add =:DESIGN:= link
2. *Work*: Add progress notes here
3. *Reconcile*: Update design doc, remove from here

** Task Format

#+begin_example
*** TODO [DAB-001-01] Task title
:PROPERTIES:
:DESIGN: [[file:docs/design/001-system-overview.org::*Tasks][001 Tasks]]
:EFFORT: M
:END:

Progress notes here.
#+end_example

** Related Files

| File                    | Purpose                       |
|-------------------------+-------------------------------|
| [[file:org-setup.org][org-setup.org]]           | Shared org-mode configuration |
| [[file:docs/design/README.org][docs/design/README.org]]  | Index of all design docs      |
| [[file:docs/design/000-template.org][000-template.org]]        | Template for new design docs  |

* Setup
:PROPERTIES:
:header-args:elisp: :results silent
:END:

** Load Workflow Commands

Evaluate this block first with =C-c C-c=:

#+begin_src elisp
;; Load workflow-commands.el from project elisp directory
(let ((elisp-dir (expand-file-name "elisp"
                                   (file-name-directory (buffer-file-name)))))
  (if (file-exists-p (expand-file-name "workflow-commands.el" elisp-dir))
      (progn
        (add-to-list 'load-path elisp-dir)
        (require 'workflow-commands)
        (message "Loaded backlog/ commands from %s" elisp-dir))
    (user-error "workflow-commands.el not found in %s" elisp-dir)))
#+end_src

** Emacs Agenda Configuration

#+begin_src elisp
(unless (fboundp 'backlog/design-get-all-docs)
  (user-error "Run the loader block above first"))
(setq backlog/agenda-files (backlog/design-get-all-docs))
(setq org-agenda-files backlog/agenda-files)
(message "Added %d design docs to agenda" (length backlog/agenda-files))
#+end_src

** Available Commands

After loading, these commands are available:

| Command                       | Description                          |
|-------------------------------+--------------------------------------|
| =M-x backlog/task-queue=        | Queue task at point into backlog.org |
| =M-x backlog/goto-design=       | Jump to design doc via :DESIGN:      |
| =M-x backlog/design-goto-doc=   | Jump to design doc by number         |
| =M-x backlog/design-next-number= | Get next available doc number       |
| =M-x backlog/design-status-report= | Summary of docs by status         |
| =M-x backlog/design-category-report= | Summary of docs by category     |

* Queries
:PROPERTIES:
:header-args:elisp: :results output
:END:

Execute any query with =C-c C-c= on the source block.
Requires loading the Setup block first.

** Task Summary

#+begin_src elisp :results output
(unless (fboundp 'backlog/design-get-all-docs)
  (user-error "Run the loader block in Setup first"))
(let ((todo-count 0) (wip-count 0) (hold-count 0) (done-count 0))
  (dolist (file (backlog/design-get-all-docs))
    (with-temp-buffer
      (insert-file-contents file)
      (goto-char (point-min))
      (while (re-search-forward "^\\*\\* TODO " nil t) (cl-incf todo-count))
      (goto-char (point-min))
      (while (re-search-forward "^\\*\\* WIP " nil t) (cl-incf wip-count))
      (goto-char (point-min))
      (while (re-search-forward "^\\*\\* HOLD " nil t) (cl-incf hold-count))
      (goto-char (point-min))
      (while (re-search-forward "^\\*\\* DONE " nil t) (cl-incf done-count))))
  (princ (format "Task Summary:\n"))
  (princ (format "  TODO: %3d\n" todo-count))
  (princ (format "  WIP:  %3d\n" wip-count))
  (princ (format "  HOLD: %3d\n" hold-count))
  (princ (format "  DONE: %3d\n" done-count))
  (princ (format "  ─────────\n"))
  (princ (format "  Total: %d\n" (+ todo-count wip-count hold-count done-count))))
#+end_src

* Quick Reference

| Status   | Meaning                              |
|----------+--------------------------------------|
| Draft    | Under development, not ready         |
| Review   | Ready for feedback                   |
| Accepted | Approved, ready to implement         |
| Active   | Implementation in progress           |
| Complete | Fully implemented and verified       |
| Archived | No longer active (rejected/obsolete) |

| Task State | Meaning             |
|------------+---------------------|
| TODO       | Not started         |
| WIP        | Work in progress    |
| HOLD       | Blocked or deferred |
| DONE       | Completed           |
