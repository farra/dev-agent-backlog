#+TITLE: 012 - Claude Tasks Integration
#+AUTHOR: dev-agent-backlog
#+STATUS: Draft
#+CATEGORY: research
#+CREATED: [2026-01-26]
#+LAST_MODIFIED: [2026-01-26]
#+SETUPFILE: ../../org-setup.org

* Summary

Position backlog.org as a universal "hub" that links to tasks wherever they
live: design docs, Claude Tasks, GitHub issues, Beads, or other systems. The
backlog becomes the human-readable rosetta stone that both agents and humans can
read, while agent-native primitives (Claude Tasks, Beads) handle coordination.

* Context

** Claude Tasks Announcement (Jan 2026)

From the Claude Code team:

#+begin_quote
We're upgrading Todos to Tasks. Tasks are a new primitive that help Claude Code
track and complete more complicated projects and collaborate on them across
multiple sessions or subagents.

Tasks are our new abstraction for coordinating many pieces of work across
projects. Claude can create Tasks with dependencies on each other that are
stored in the metadata. Additionally, Tasks are stored in the file system so
that multiple subagents or sessions can collaborate on them. When one session
updates a Task, that is broadcasted to all sessions currently working on the
same Task List.
#+end_quote

Key capabilities:
- Stored in =~/.claude/tasks= as files
- Support dependencies between tasks
- Cross-session coordination via =CLAUDE_CODE_TASK_LIST_ID= env var
- Works with subagents and AgentSDK
- Broadcasted updates when multiple sessions share a Task List

** Beads (Steve Yegge)

Beads was cited as inspiration for Claude Tasks. It's another agent coordination
system with its own primitives. If we design backlog.org as a hub, it can link
to Beads references just as easily as Claude Tasks.

** The Problem with "Shadow" Approaches

Earlier thinking proposed creating Claude Tasks as "shadows" of org tasks—keeping
them in sync bidirectionally. This adds complexity:
- Sync logic for status changes
- Conflict resolution
- Duplicate state to maintain

A better model: backlog.org doesn't duplicate—it *links*.

* Goals and Non-Goals

** Goals

1. *backlog.org as hub*: Human-readable index linking to tasks in any system
2. *No duplication*: Links and handoff notes only, not copied content
3. *System agnostic*: Same pattern works for Claude Tasks, Beads, GitHub, etc.
4. *Both audiences*: Humans read backlog directly; agents follow links to native primitives

Success criteria:
- A single backlog entry can reference design doc, Claude Task, AND GitHub issue
- Agents can parse links to find their native coordination primitives
- Humans see a unified view without understanding ~/.claude/tasks JSON
- Adding new systems (Beads, Linear, etc.) requires only new property conventions

** Non-Goals

- Bidirectional sync between systems
- Replacing any system with another
- Forcing all tasks through all systems

* Proposal

** The Hub Model

#+begin_example
                        backlog.org (hub/glue)
                              │
         ┌────────────┬───────┴───────┬────────────┐
         ▼            ▼               ▼            ▼
    Design Doc    Claude Task    GitHub Issue    Bead
    :SOURCE:      :CLAUDE_TASK:  :GITHUB:        :BEAD:
#+end_example

backlog.org is the *join table*—a human-readable index that links to wherever
tasks are authoritatively defined or coordinated.

** Backlog Entry with Multiple Links

#+begin_src org
*** WIP [DAB-012-02] Update task-start to create Claude Task
:PROPERTIES:
:SOURCE: [[file:docs/design/012-claude-tasks.org::*Tasks][DAB-012-02 in design doc]]
:CLAUDE_TASK: [[file:~/.claude/tasks/dab-012/task-002.json][task-002]]
:GITHUB: [[https://github.com/farra/dev-agent-backlog/issues/15][#15]]
:BEAD: [[bead:session-xyz/task-002][bead ref]]
:EFFORT: M
:HANDOFF: Started implementation, need to test cross-session sync
:WORKED_BY: claude-code
:END:

Progress notes stay here in org format...
#+end_src

** What Each System Provides

| System       | Property       | Purpose                              |
|--------------+----------------+--------------------------------------|
| Design Doc   | =:SOURCE:=     | Canonical definition, context, spec  |
| Claude Tasks | =:CLAUDE_TASK:= | Cross-session/subagent coordination |
| GitHub       | =:GITHUB:=     | External tracking, collaboration     |
| Beads        | =:BEAD:=       | Alternative agent coordination       |
| Linear/Jira  | =:LINEAR:=     | Team project management              |

** How Each Audience Uses the Hub

*** Humans

Read backlog.org directly:
- See all active work in one place
- Read progress notes and handoff context
- Follow =:SOURCE:= to design docs for full context
- Don't need to understand Claude Tasks JSON or Beads format

*** Claude / Agents

Read backlog.org, then follow links:
1. Parse backlog.org to find WIP tasks
2. Check for =:CLAUDE_TASK:= property
3. If present, use Claude Task for coordination (dependencies, broadcast)
4. If absent, create one if multi-session work is needed
5. Always update =:HANDOFF:= in backlog for human visibility

*** Subagents

When spawning subagents:
1. Create Claude Tasks for coordination
2. Parent agent adds =:CLAUDE_TASK:= link to backlog entry
3. Subagents update Claude Task status
4. Broadcast keeps parent informed
5. Results reconciled back through backlog

** Workflow Examples

*** Single-Session Work

No Claude Task needed:

#+begin_example
/task-start DAB-012-01
→ Check backlog for task
→ No :CLAUDE_TASK: property, that's fine
→ Work happens in single session
→ Update :HANDOFF: before stopping
/task-complete DAB-012-01
→ Reconcile to design doc
#+end_example

*** Multi-Session Work

Create Claude Task for coordination:

#+begin_example
/task-start DAB-012-02
→ Check backlog for task
→ Complex work, will span sessions
→ Create Claude Task, add :CLAUDE_TASK: to backlog
→ Work in session 1...
→ Session ends, :HANDOFF: updated

[New session]
→ backlog-resume finds WIP task
→ Follows :CLAUDE_TASK: link for coordination state
→ Continues work
/task-complete DAB-012-02
→ Mark Claude Task complete
→ Reconcile to design doc
#+end_example

*** Parallel Subagent Work

#+begin_example
/task-start DAB-012-05
→ Large task, spawn 3 subagents
→ Create Claude Task List with 3 dependent Tasks
→ Add :CLAUDE_TASK: pointing to parent Task
→ Subagents work in parallel, updating their Tasks
→ Broadcast keeps main session informed
→ All complete → mark parent Task done
/task-complete DAB-012-05
#+end_example

** Link Property Conventions

*** Required: SOURCE

Every backlog task MUST have =:SOURCE:= linking to canonical definition:

#+begin_src org
:SOURCE: [[file:docs/design/NNN-doc.org::*Tasks][ID in doc.org]]
#+end_src

*** Optional: CLAUDE_TASK

Add when multi-session or subagent coordination is needed:

#+begin_src org
:CLAUDE_TASK: [[file:~/.claude/tasks/<list-id>/<task-id>.json][task-id]]
#+end_src

Or for Task Lists:

#+begin_src org
:CLAUDE_TASK_LIST: <list-id>
#+end_src

*** Optional: GITHUB

Link to GitHub issue if external tracking exists:

#+begin_src org
:GITHUB: [[https://github.com/owner/repo/issues/N][#N]]
#+end_src

*** Optional: BEAD

Link to Bead reference (format TBD based on Beads conventions):

#+begin_src org
:BEAD: [[bead:<session>/<task>][bead ref]]
#+end_src

*** Future: Other Systems

Same pattern extends to any system:

#+begin_src org
:LINEAR: [[https://linear.app/team/issue/XXX][XXX]]
:JIRA: [[https://org.atlassian.net/browse/KEY-123][KEY-123]]
:NOTION: [[https://notion.so/page-id][Page Title]]
#+end_src

* Questions                                                      :questions:

** OPEN When should Claude auto-create a Claude Task?

Options:
1. *Never auto* - Only when explicitly requested or via /task-list command
2. *Heuristic* - Create when task has dependencies or spans sessions
3. *Always for WIP* - Any task moved to WIP gets a Claude Task

Leaning toward (2): Let Claude judge when coordination primitives are needed.

** OPEN What's the Beads link format?

Need to investigate Beads conventions to define =:BEAD:= property format.

** OPEN Should we support reverse links?

Should Claude Tasks or GitHub issues link back to backlog.org?

Options:
1. *No* - Hub is one-way, keeps systems decoupled
2. *Yes, in notes* - Add backlog path in Task/issue description
3. *Convention* - Standard comment like "Tracked in: backlog.org#DAB-012-02"

Leaning toward (2): Non-intrusive, helps navigation.

* Tasks                                                              :tasks:

** TODO [DAB-012-01] Document hub model in CLAUDE.md                     :p1:
:PROPERTIES:
:EFFORT: S
:END:

Explain backlog.org as hub, link properties, when to create Claude Tasks.

** TODO [DAB-012-02] Add :CLAUDE_TASK: property support to task-start    :p1:
:PROPERTIES:
:EFFORT: M
:END:

When starting a task, optionally create Claude Task and add property link.
Heuristic: create if task has dependencies or user requests multi-session work.

** TODO [DAB-012-03] Update backlog-resume to follow :CLAUDE_TASK: links :p1:
:PROPERTIES:
:EFFORT: S
:END:

When resuming, check for Claude Task links and surface coordination state.

** TODO [DAB-012-04] Add :GITHUB: property support                       :p2:
:PROPERTIES:
:EFFORT: S
:END:

Document convention, update task-queue to accept GitHub issue URL.

** TODO [DAB-012-05] Research Beads integration                          :p2:
:PROPERTIES:
:EFFORT: M
:END:

Investigate Beads format, define =:BEAD:= property convention.

** TODO [DAB-012-06] Create /task-link command                           :p2:
:PROPERTIES:
:EFFORT: M
:END:

New command to add links to existing backlog tasks:

#+begin_example
/task-link DAB-012-02 --claude-task <id>
/task-link DAB-012-02 --github https://github.com/.../issues/15
/task-link DAB-012-02 --bead session-xyz/task-002
#+end_example

* References

- [[https://x.com/trq212/status/2014480496013803643][Claude Tasks Announcement (Twitter)]]
- [[file:009-beads-features.org][009 - Beads-Inspired Features]] - Prior analysis, Beads as inspiration
- [[file:005-gastown-features.org][005 - Gastown-Inspired Features]] - Session continuity patterns
- [[file:003-backlog-workflow.org][003 - Backlog Workflow]] - Current backlog.org design
- [[file:011-plugin-architecture.org][011 - Plugin Architecture]] - Current plugin structure

* Changelog

- *2026-01-26:* Revised to hub model (backlog as universal glue)
- *2026-01-26:* Initial draft exploring shadow/sync approaches
